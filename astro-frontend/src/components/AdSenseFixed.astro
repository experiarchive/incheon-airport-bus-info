---
// Fixed-size AdSense component for airport bus info
// PC: 728x90, Mobile: 320x100
---

<div class="adsense-fixed-container my-10 text-center">
  <p class="text-[10px] text-gray-400 text-center mb-1 font-sans">
    Sponsored
  </p>
  
  <div class="ad-wrapper w-full overflow-hidden bg-gray-50 dark:bg-gray-800/50 rounded-lg flex justify-center items-center py-4">
    <!-- PC Ad (hidden on mobile) -->
    <div class="hidden md:block">
      <ins class="adsbygoogle"
           style="display:inline-block;width:728px;height:90px"
           data-ad-client="ca-pub-8355312170222120"
           data-ad-slot="9700153785"></ins>
    </div>
    
    <!-- Mobile Ad (hidden on PC) -->
    <div class="block md:hidden">
      <ins class="adsbygoogle"
           style="display:inline-block;width:320px;height:100px"
           data-ad-client="ca-pub-8355312170222120"
           data-ad-slot="8387072118"></ins>
    </div>
  </div>
</div>

<script>
  // Intersection Observer with retry mechanism for layout timing issues
  document.addEventListener('DOMContentLoaded', () => {
    const fixedContainers = document.querySelectorAll('.adsense-fixed-container');
    
    // Helper function to find visible slot and attempt ad load with retry
    const tryLoadFixedAd = (container, retryCount = 0, maxRetries = 3) => {
      const allSlots = container.querySelectorAll('.adsbygoogle');
      let visibleSlot = null;
      
      allSlots.forEach(slot => {
        if (slot.offsetWidth > 0 && !slot.hasAttribute('data-ad-loaded')) {
          visibleSlot = slot;
        }
      });
      
      if (visibleSlot) {
        visibleSlot.setAttribute('data-ad-loaded', 'true');
        try {
          (window.adsbygoogle = window.adsbygoogle || []).push({});
        } catch (e) {
          // Suppress errors (TagError is non-fatal and handled by global handler or retries)
          // if (!window.location.hostname.includes('localhost')) {
          //   console.error('AdSense fixed push error:', e);
          // }
        }
        return true;
      } else if (retryCount < maxRetries) {
        // Layout not ready, wait and retry
        requestAnimationFrame(() => {
          setTimeout(() => {
            tryLoadFixedAd(container, retryCount + 1, maxRetries);
          }, 100);
        });
        return false;
      }
      return false;
    };
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const container = entry.target;
          tryLoadFixedAd(container);
          observer.unobserve(container); // Unobserve immediately, retries handle the rest
        }
      });
    }, {
      rootMargin: '200px 0px',
      threshold: 0
    });
    
    fixedContainers.forEach((c) => observer.observe(c));
  });
</script>
