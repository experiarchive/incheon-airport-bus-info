---
import Layout from '../layouts/Layout.astro';

// Welcome to Astro! Wondering what to do next? Check out the Astro documentation at https://docs.astro.build
// Don't want to use any of this? Delete everything in this file, the `assets`, `components`, and `layouts` directories, and start fresh.
---

<Layout 
	title="ê°€ì¥ ë¹ ë¥¸ ì¸ì²œê³µí•­ ë²„ìŠ¤ ì°¾ê¸°"
	description="ì¸ì²œê³µí•­ìœ¼ë¡œ ê°€ëŠ” ê°€ì¥ ë¹ ë¥¸ ë²„ìŠ¤ ë…¸ì„ ì„ ê²€ìƒ‰í•˜ê³  ì‹¤ì‹œê°„ ì‹œê°„í‘œ, ìš”ê¸ˆ, ì •ë¥˜ì¥ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”."
	keywords="ê³µí•­ë²„ìŠ¤, ì¸ì²œê³µí•­, ê³µí•­ë²„ìŠ¤ ê²€ìƒ‰, ê³µí•­ë²„ìŠ¤ ì‹œê°„í‘œ, ê³µí•­ë²„ìŠ¤ ì˜ˆë§¤"
>
	<div class="flex flex-col items-center justify-center text-center py-20 md:py-32 px-4">
		<h1 class="text-4xl md:text-5xl font-extrabold text-gray-800 dark:text-white mb-4">
			ì¸ì²œê³µí•­ ê³µí•­ë²„ìŠ¤ ì°¾ê¸°
		</h1>
		<p class="text-lg text-gray-600 dark:text-gray-300 mb-8 max-w-2xl">
			ë²„ìŠ¤ ë²ˆí˜¸, ì •ë¥˜ì¥, ë˜ëŠ” ëª©ì ì§€(ì˜ˆ: ê°•ë‚¨ì—­)ë¥¼ ì…ë ¥í•˜ì—¬ ì‹¤ì‹œê°„ ìš´í–‰ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.
		</p>

		<div id="search-container" class="relative w-full max-w-2xl">
			<div class="relative">
				<div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
					<svg class="h-6 w-6 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
					</svg>
				</div>
				<input
					type="text"
					id="search-input"
					placeholder="ë²„ìŠ¤ ë²ˆí˜¸ ë˜ëŠ” ì •ë¥˜ì¥/ì§€ì—­ëª… ê²€ìƒ‰"
					class="w-full p-4 pl-12 text-lg border-2 border-gray-200 dark:border-gray-600 rounded-full shadow-lg focus:ring-4 focus:ring-blue-300 dark:focus:ring-blue-800 focus:border-blue-500 dark:focus:border-blue-500 dark:bg-gray-700 dark:text-white transition duration-300"
				/>
			</div>
			<div id="search-results" class="absolute z-10 w-full mt-2 bg-white dark:bg-gray-800 rounded-lg shadow-xl hidden overflow-hidden border border-gray-200 dark:border-gray-600 text-left">
				<!-- Search results will be populated here -->
			</div>
		</div>

		<div class="mt-8 text-center">
			<span class="text-gray-600 dark:text-gray-400">ì£¼ìš” ë…¸ì„ :</span>
			<a href="/routes/6014" class="ml-2 text-blue-600 hover:underline">6014</a>,
			<a href="/routes/6300" class="ml-2 text-blue-600 hover:underline">6300</a>,
			<a href="/routes/6703" class="ml-2 text-blue-600 hover:underline">6703</a>,
			<a href="/routes/6705A" class="ml-2 text-blue-600 hover:underline">6705A</a>
		</div>
	</div>
</Layout>

<script>
	const searchInput = document.getElementById('search-input') as HTMLInputElement | null;
	const searchResultsContainer = document.getElementById('search-results');
	const searchContainer = document.getElementById('search-container');
	let searchData: any[] = [];

	// Fetch search data
	fetch('/search-data.json')
		.then(response => response.json())
		.then(data => {
			searchData = data;
		})
		.catch(error => console.error('Error fetching search data:', error));

	searchInput?.addEventListener('input', (e) => {
		const query = (e.target as HTMLInputElement).value.toLowerCase().trim();
		
		if (query.length === 0) {
			hideResults();
			return;
		}

		const results: any[] = [];
		const MAX_RESULTS = 7;

		// 1. Find routes that match the route number
		for (const route of searchData) {
			if (route.routeNumber && route.routeNumber.toLowerCase().startsWith(query)) {
				results.push({ type: 'route', ...route });
			}
			if (results.length >= MAX_RESULTS) break;
		}

		// 2. Find routes that have matching stop names
		if (results.length < MAX_RESULTS) {
			for (const route of searchData) {
				if (route.stops && route.stops.some((stop: string) => stop.toLowerCase().includes(query))) {
					// Avoid adding duplicate routes
					if (!results.some(r => r.routeNumber === route.routeNumber)) {
						results.push({ type: 'route', ...route, match: 'stop' });
					}
				}
				if (results.length >= MAX_RESULTS) break;
			}
		}

		displayResults(results);
	});
	
	function displayResults(results: any[]) {
		if (!searchResultsContainer) return;
		if (results.length === 0) {
			searchResultsContainer.innerHTML = `<div class="p-4 text-gray-500">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
			showResults();
			return;
		}

		searchResultsContainer.innerHTML = results.map((result: any) => {
			if (result.type === 'route') {
				const highlight = result.match === 'stop' ? `(ì •ë¥˜ì¥ ì¼ì¹˜)` : '';
				return `
					<a href="/routes/${result.routeNumber}" class="block p-4 hover:bg-blue-50 dark:hover:bg-blue-900 border-b border-gray-200 dark:border-gray-600 last:border-b-0">
						<div class="flex items-center">
							<span class="text-xl font-bold text-blue-600 dark:text-blue-400 mr-3">ğŸšŒ ${result.routeNumber}</span>
							<span class="text-gray-700 dark:text-gray-300">${result.routeName || ''} ${highlight}</span>
						</div>
					</a>
				`;
			}
			return '';
		}).join('');

		showResults();
	}

	function showResults() {
		searchResultsContainer?.classList.remove('hidden');
	}

	function hideResults() {
		searchResultsContainer?.classList.add('hidden');
	}

	// Hide results when clicking outside
	document.addEventListener('click', (e) => {
		if (searchContainer && !searchContainer.contains(e.target as Node)) {
			hideResults();
		}
	});

</script>
